<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Event-loop | 挣扎的咸鱼</title>
    <meta name="description" content="自己做自己的大神吧">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.c1aa5349.css" as="style"><link rel="preload" href="/assets/js/app.e473c4b1.js" as="script"><link rel="preload" href="/assets/js/2.a1a30593.js" as="script"><link rel="preload" href="/assets/js/62.af914b81.js" as="script"><link rel="prefetch" href="/assets/js/10.3a909b5a.js"><link rel="prefetch" href="/assets/js/11.c9bfe952.js"><link rel="prefetch" href="/assets/js/12.d4753f53.js"><link rel="prefetch" href="/assets/js/13.f9782e6c.js"><link rel="prefetch" href="/assets/js/14.c38d7476.js"><link rel="prefetch" href="/assets/js/15.f7787999.js"><link rel="prefetch" href="/assets/js/16.9c8e63b8.js"><link rel="prefetch" href="/assets/js/17.48751c8e.js"><link rel="prefetch" href="/assets/js/18.44e148aa.js"><link rel="prefetch" href="/assets/js/19.164a73ac.js"><link rel="prefetch" href="/assets/js/20.fcfa3924.js"><link rel="prefetch" href="/assets/js/21.32550108.js"><link rel="prefetch" href="/assets/js/22.b5275d7b.js"><link rel="prefetch" href="/assets/js/23.caf4ab7b.js"><link rel="prefetch" href="/assets/js/24.8b4d1f81.js"><link rel="prefetch" href="/assets/js/25.b54b0543.js"><link rel="prefetch" href="/assets/js/26.53d5d2e7.js"><link rel="prefetch" href="/assets/js/27.7d1c7d50.js"><link rel="prefetch" href="/assets/js/28.f44f48ba.js"><link rel="prefetch" href="/assets/js/29.8aa4ff21.js"><link rel="prefetch" href="/assets/js/3.c8efe87c.js"><link rel="prefetch" href="/assets/js/30.ad48c56e.js"><link rel="prefetch" href="/assets/js/31.cdd2589a.js"><link rel="prefetch" href="/assets/js/32.2e319305.js"><link rel="prefetch" href="/assets/js/33.3a08d308.js"><link rel="prefetch" href="/assets/js/34.a7596d5b.js"><link rel="prefetch" href="/assets/js/35.00605a5b.js"><link rel="prefetch" href="/assets/js/36.869de2d9.js"><link rel="prefetch" href="/assets/js/37.0a7c89da.js"><link rel="prefetch" href="/assets/js/38.7643e598.js"><link rel="prefetch" href="/assets/js/39.65adb31c.js"><link rel="prefetch" href="/assets/js/4.14d6f920.js"><link rel="prefetch" href="/assets/js/40.67d6550c.js"><link rel="prefetch" href="/assets/js/41.1ede1cee.js"><link rel="prefetch" href="/assets/js/42.1068c659.js"><link rel="prefetch" href="/assets/js/43.c6f41cb7.js"><link rel="prefetch" href="/assets/js/44.27b3f928.js"><link rel="prefetch" href="/assets/js/45.d60e451b.js"><link rel="prefetch" href="/assets/js/46.372cf32a.js"><link rel="prefetch" href="/assets/js/47.2b001df9.js"><link rel="prefetch" href="/assets/js/48.b9f35f1f.js"><link rel="prefetch" href="/assets/js/49.4156fdf8.js"><link rel="prefetch" href="/assets/js/5.f60c3c65.js"><link rel="prefetch" href="/assets/js/50.fd4630cd.js"><link rel="prefetch" href="/assets/js/51.c61579ed.js"><link rel="prefetch" href="/assets/js/52.3bed06b1.js"><link rel="prefetch" href="/assets/js/53.848280b1.js"><link rel="prefetch" href="/assets/js/54.f38d6843.js"><link rel="prefetch" href="/assets/js/55.ed1741d4.js"><link rel="prefetch" href="/assets/js/56.23414552.js"><link rel="prefetch" href="/assets/js/57.9b0abd09.js"><link rel="prefetch" href="/assets/js/58.28d54d7a.js"><link rel="prefetch" href="/assets/js/59.ab120788.js"><link rel="prefetch" href="/assets/js/6.da3ad6c3.js"><link rel="prefetch" href="/assets/js/60.f624171c.js"><link rel="prefetch" href="/assets/js/61.bdd3be63.js"><link rel="prefetch" href="/assets/js/63.4ed4c8e3.js"><link rel="prefetch" href="/assets/js/64.06e98283.js"><link rel="prefetch" href="/assets/js/65.316fc7ed.js"><link rel="prefetch" href="/assets/js/66.20c94f01.js"><link rel="prefetch" href="/assets/js/7.c4819eb6.js"><link rel="prefetch" href="/assets/js/8.2d31cd82.js"><link rel="prefetch" href="/assets/js/9.8ea3bdfa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c1aa5349.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><main><main slot="sidebar-top"><a href="https://sunny2009day.github.io/" aria-label="View source on GitHub" target="_blank" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path> <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm" style="transform-origin: 130px 106px;"></path> <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></main> <div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">挣扎的咸鱼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/all/" class="nav-link">
  all
</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">
  js
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/Interview/" class="nav-link">
  Interview
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/all/" class="nav-link">
  all
</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">
  js
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/Interview/" class="nav-link">
  Interview
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/" class="sidebar-link">Introduction</a></li><li><a href="/js/Event-loop.html" class="active sidebar-link">Event-loop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/Event-loop.html#javascript-的运行机制" class="sidebar-link">JavaScript 的运行机制</a></li><li class="sidebar-sub-header"><a href="/js/Event-loop.html#进程和线程的区别" class="sidebar-link">进程和线程的区别</a></li><li class="sidebar-sub-header"><a href="/js/Event-loop.html#nodejs的应用" class="sidebar-link">nodejs的应用</a></li><li class="sidebar-sub-header"><a href="/js/Event-loop.html#浏览器进程" class="sidebar-link">浏览器进程</a></li><li class="sidebar-sub-header"><a href="/js/Event-loop.html#node事件执行机制" class="sidebar-link">node事件执行机制</a></li><li class="sidebar-sub-header"><a href="/js/Event-loop.html#node与浏览器的event-loop差异" class="sidebar-link">node与浏览器的event loop差异</a></li></ul></li><li><a href="/js/js-dev-of-module-dev.html" class="sidebar-link">js-模块化开发的发展</a></li><li><a href="/js/temporary-ded-var-promotion.html" class="sidebar-link">暂存死区和变量提升</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="javascript-的运行机制"><a href="#javascript-的运行机制" class="header-anchor">#</a> JavaScript 的运行机制</h2> <ul><li>代码是<code>CPU</code>执行的,js是一种解释型的动态<strong>单线程</strong>语言,跨平台,即时编译,也不会有目标代码生成。这个过程通常由宿主环境（如浏览器、Node.js）包办。</li> <li>浏览器进程(进程process计算机分配任务和调度的最先单位)，一个进程可以包括多个线程,js是线程执行的,并且<strong>JavaScript 是单线程语言</strong>，Web-Worker 还是 node 里面的cluster创造多线程环境,内部都是单线程执行，而且 cluster 还是进程管理相关；</li> <li>单线程模型,即所有任务只能在一个线程上完成,前面的任务没做完,后面的任务只能等着;<code>js</code>的单线程形成了一个浏览器事件环, 主线程只有一个 <code>setTimeout</code>, <code>ajax</code>, <code>setInterval</code>, <code>requestFrameAnimation</code>事件， 事件环来实现任务的调度</li> <li>js 基本分组成 ： (BOM DOM) ECMAScript (es6模块) 模块的特性 api包 帮你实现文件操作服务器端的创建</li> <li>单线程的优点
1&gt; 高并发
2&gt; 适合i/o密集
3&gt; 解决切换上下文时间,锁的问题,节省内存</li> <li>单线程的缺点
1&gt; 不适合cpu密集
2&gt; 易阻塞</li></ul> <h2 id="进程和线程的区别"><a href="#进程和线程的区别" class="header-anchor">#</a> 进程和线程的区别</h2> <ul><li>一个进程中可以有多个线程，比如渲染线程、JS 引擎线程、HTTP 请求线程等等,进程表示一个程序，线程是进程中的单位 ,主线程只有一个</li> <li>1个进程可以占用1核cpu ，node可以（开 4 - 32个子进程）</li> <li>多线程在单核cpu中其实也是顺序执行的，不过系统可以帮你切换那个执行而已，没有提高速度</li> <li>多个cpu的话就可以在多个cpu中同时执行</li></ul> <h2 id="nodejs的应用"><a href="#nodejs的应用" class="header-anchor">#</a> nodejs的应用</h2> <ul><li>nodejs 是runtime可以让js运行在服务端上,单线程</li></ul> <ol><li>写脚本,中间层,服务端渲染(vue, react)可以实现前后端分离，例如服务端的eggs,nest</li> <li>实现高性能的web服务</li></ol> <h2 id="浏览器进程"><a href="#浏览器进程" class="header-anchor">#</a> 浏览器进程</h2> <blockquote><p>浏览器是计算机应用程序,每一个tab页都会启动新的主进程和GPU进程;
<img src="https://upload-images.jianshu.io/upload_images/14983171-fe6f56706aa61140.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p></blockquote> <blockquote><p>js线程执行的事件huan
<strong>event loop</strong></p></blockquote> <p><img src="https://upload-images.jianshu.io/upload_images/14983171-da38087f03e05551.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1573232016(1).jpg"></p> <blockquote><p>同步任务和异步任务是广义的定义,更精细的是
微任务： promise.then ，MutationObserver(监视对DOM树所做更改)，process.nextTick
宏任务：script ，ajax ， 事件，requestFrameAnimation， setTimeout ，setInterval ，setImmediate （ie下），MessageChannel ，I/O ，UI rendering。</p></blockquote> <ul><li>同一event table下,微任务会比宏任务快，js中会先执行script脚本</li></ul> <h4 id="vue-nexttick-vue-dom渲染都是异步的-dom渲染原生的是同步的-vue中把dom渲染变成异步，nexttick放到异步回调之后"><a href="#vue-nexttick-vue-dom渲染都是异步的-dom渲染原生的是同步的-vue中把dom渲染变成异步，nexttick放到异步回调之后" class="header-anchor">#</a> vue.nextTick(vue dom渲染都是异步的),dom渲染原生的是同步的,vue中把dom渲染变成异步，nextTick放到异步回调之后</h4> <p>可在<a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener noreferrer">https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
执行异步同步事件有详细的讲解：如图:
<img src="https://upload-images.jianshu.io/upload_images/14983171-dd37f135328b1793.gif?imageMogr2/auto-orient/strip" alt="640.gif"></p> <h2 id="node事件执行机制"><a href="#node事件执行机制" class="header-anchor">#</a> node事件执行机制</h2> <ul><li>Node 和浏览器的Event Loop是两个有明确区分的事物。nodejs的event是基于libuv，而浏览器的event loop则在html5的规范中明确定义。
<img src="https://upload-images.jianshu.io/upload_images/14983171-9830cd70b975328f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li></ul> <p>Node 的 Event Loop 分为 6 个阶段：</p> <ol><li>timers：定时器,执行setTimeout() 和 setInterval()中到期的callback。</li> <li>pending callback: 上一轮循环中有少数的I/O callback会被延迟到这一轮的这一阶段执行
3 .idle, prepare：内部的一些准备操作
4 .poll: 最为重要的阶段，执行I/O callback，在适当的条件下会阻塞在这个阶段</li> <li>check: 执行setImmediate的callback,检查阶段</li> <li>close callbacks: 执行close事件的callback，例如socket.on('close'[,fn])、http.server.on('close, fn)
<strong>poll 的i/o操作,如果没有check会阻塞在这里等定时器到达*时间，如果有check会在轮训完毕后立即执行</strong></li></ol> <ul><li>process.nextTick拥有一个自己的队列,是优先于promise.then的微任务,当前promise微任务完成之后处理nextTickQueue,如果存在 nextTickQueue，就会清空队列中的所有回调函数(then,catch)，并且优先于其他 microtask 执行(执行一次微任务处理一次回调)。</li> <li>setImmediate() 和 setTimeout()非常的相似执行时序受进程性能的限制;</li></ul> <h2 id="node与浏览器的event-loop差异"><a href="#node与浏览器的event-loop差异" class="header-anchor">#</a> node与浏览器的event loop差异</h2> <p><strong>浏览器环境下，microtask的任务队列是每个macrotask执行完之后执行。而在Node.js中，microtask会在事件循环的各个阶段之间执行，也就是一个阶段执行完毕，就会去执行microtask队列的任务。</strong> <img src="https://upload-images.jianshu.io/upload_images/14983171-730829ffff64b37a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1573301160(1).jpg"> <img src="https://upload-images.jianshu.io/upload_images/14983171-e6b4252c0399f5b6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1573303078(1).jpg"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js/" class="prev router-link-active">
        Introduction
      </a></span> <span class="next"><a href="/js/js-dev-of-module-dev.html">
        js-模块化开发的发展
      </a>
      →
    </span></p></div> </main></div> <div class="footer" data-v-35b17a59><div id="footer-info" data-v-35b17a59><div class="footer-left" data-v-35b17a59>
      © 2019-2020
      <span data-v-35b17a59><a href="https://sunny2009day.github.io/" target="_blank">积极向上</a></span></div> <div class="footer-right" data-v-35b17a59>Theme:<a href="https://github.com/JoeyBling/vuepress-theme-yilia-plus" target="_blank">vuepress-theme-yilia-plus</a> by Litten</div></div> <div class="busuanzi" data-v-35b17a59><span id="busuanzi_container_site_pv" style="display:none">
    本站总访问量
    <span id="busuanzi_value_site_pv"></span>次
    <span class="post-meta-divider">|</span></span> <span id="busuanzi_container_site_uv" style="display:none">
    本站访客数
    <span id="busuanzi_value_site_uv"></span>人
  </span></div></div></main><div class="global-ui"><!----><div></div></div></div>
    <script src="/assets/js/app.e473c4b1.js" defer></script><script src="/assets/js/2.a1a30593.js" defer></script><script src="/assets/js/62.af914b81.js" defer></script>
  </body>
</html>
