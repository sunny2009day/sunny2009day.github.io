(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{305:function(t,s,a){"use strict";a.r(s);var r=a(5),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("location [=|~|~*|^~] /uri/ { … }中的相关规则")])]),t._v(" "),a("ul",[a("li",[t._v("= 开头表示精确匹配")]),t._v(" "),a("li",[t._v("^~ 开头表示uri以某个常规字符串开头，理解为匹配 url路径即可。nginx不对url做编码，因此请求为/static/20%/aa，- 可以被规则^~ /static/ /aa匹配到（注意是空格）。")]),t._v(" "),a("li",[t._v("~ 开头表示区分大小写的正则匹配")]),t._v(" "),a("li",[t._v("~* 开头表示不区分大小写的正则匹配")]),t._v(" "),a("li",[t._v("!~和!~*分别为区分大小写不匹配及不区分大小写不匹配 的正则")]),t._v(" "),a("li",[t._v("/ 通用匹配，任何请求都会匹配到。")])]),t._v(" "),a("blockquote",[a("p",[t._v("nginx反向代理和静态文件拦截:")])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("#负载均衡服务器池\n    upstream express "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       server  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    #"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3333")]),t._v("端口指向门户网站\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        server_name  www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("portal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#charset koi8 - r; ")]),t._v("\n        access_log  logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nodejs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("express"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        #静态文件拦截器\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" \\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" htm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" js "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" css "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" gif "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jpg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jpeg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" png "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" bmp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" swf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ico"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root  D"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("git_in_Intranet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cloud_platform"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("front"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        access_log off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        add_header Cache "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Control no "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" #禁止缓存\n        "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#expires max; #设置缓存上面定义的后缀文件缓存到浏览器的生存时间")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" common"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" css"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" images"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" js"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" mainpage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root  D"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("git_in_Intranet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cloud_platform"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("front"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        access_log off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        expires max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nodecache"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" #nodecache 指定的key_zone\n        allow "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" #只允许本机访问  \n        deny all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" #禁止其他所有ip  \n        "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# proxy_cache_purge  /nodecache $uri; #清理缓存  ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      root   D"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("git_in_Intranet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cloud_platform"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("front"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      index  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    # 请求得地址是http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("express\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# location /api {")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# proxy_set_header X - Real - IP $remote_addr; ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for; ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#  proxy_set_header Host  $http_host; ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#  proxy_set_header X - Nginx - Proxy true; ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v('# proxy_set_header Connection ""; ')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#proxy_cache nodecache; ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#proxy_cache_key $url; #定义缓存唯一key, 通过唯一key来进行hash存取")]),t._v("\n  \n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# proxy_pass   http://express/;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# proxy_redirect default; ")]),t._v("\n    #  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    # 实际请求得路径http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("express"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("psite\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("psite "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_set_header X "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Real "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" IP $remote_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      proxy_set_header X "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Forwarded "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" For $proxy_add_x_forwarded_for"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      proxy_set_header Host  $http_host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      proxy_set_header X "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Proxy true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      proxy_set_header Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#proxy_cache nodecache; ")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#proxy_cache_key $url; #定义缓存唯一key, 通过唯一key来进行hash存取")]),t._v("\n      proxy_pass   http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("express"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      proxy_redirect "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#location /portal {")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# proxy_set_header X - Real - IP $remote_addr; ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# proxy_set_header X - ")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("nginx 其起服务只能监听80端口,代理包不包扣重定向pathRewrite得区别是proxy_pass属性后的'/';")])]),t._v(" "),a("ul",[a("li",[t._v("如果访问得是http://A\n    location  = /location/\n    proxy_pass   http://express/; http://A/location/ => http://express/")]),t._v(" "),a("li",[t._v("location  = /location/\n    proxy_pass   http://express;  http://A/location/ => http://express/location/")])]),t._v(" "),a("blockquote",[a("p",[t._v("nginx 中的\nalias即路径的别名,根目录是绝对目录")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("alias static")]),t._v(",此时static会相对于nginx所在盘符,"),a("code",[t._v("alias /static")]),t._v(",此时static会相对于\nroot的盘符目录")])])])}),[],!1,null,null,null);s.default=e.exports}}]);